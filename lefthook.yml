# Lefthook Git Hooks Configuration
# https://github.com/evilmartians/lefthook
#
# Fast pre-commit hook runs: type checking + unit tests (excludes property tests)
# Property tests can be run manually: npm run test:property
#
# Skip hooks when needed:
#   LEFTHOOK=0 git commit -m "message"     # Skip all hooks
#   SKIP=typecheck git commit -m "message" # Skip specific hook

pre-commit:
  parallel: true
  commands:
    skill-location:
      glob: "**/SKILL.md"
      run: ./scripts/check-skill-location.sh
      fail_text: "Skills must be at repo root level (<skill-name>/SKILL.md), not in packages/ or elsewhere. See error above."

    hook-location:
      glob: "**/*.sh"
      run: ./scripts/check-hook-location.sh
      fail_text: "Shell scripts must be in hooks/, scripts/, packages/, or <skill>/scripts/. See error above."

    typecheck:
      glob: "*.{ts,tsx}"
      root: "packages/skills-library"
      run: npm run typecheck
      fail_text: "TypeScript type check failed. Fix type errors before committing."

    unit-tests:
      glob: "*.{ts,tsx}"
      root: "packages/skills-library"
      run: npm test
      fail_text: "Unit tests failed. Fix failing tests before committing."

    chain-validate:
      glob: "packages/chain/chains/*.yaml"
      root: "packages/chain"
      run: npx tsx src/cli/index.ts validate
      fail_text: "Chain validation failed. Fix skills.yaml or profiles.yaml errors."

    claudemd-sync:
      glob: "**/SKILL.md"
      run: npx tsx packages/cli/src/index.ts claudemd sync && git add CLAUDE.md
      fail_text: "CLAUDE.md sync failed."

# Optional: Uncomment to add property tests to pre-push hook instead
# pre-push:
#   commands:
#     property-tests:
#       root: "packages/skills-library"
#       run: npm run test:property
#       fail_text: "Property tests failed."

# Commit message validation (optional)
# commit-msg:
#   commands:
#     check-format:
#       run: |
#         if ! head -1 {1} | grep -qE "^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}"; then
#           echo "Commit message should follow conventional commits format"
#           exit 1
#         fi

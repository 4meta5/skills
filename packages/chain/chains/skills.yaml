# Skill Chain Specifications
# Defines capabilities, requirements, and tool policies for each skill

version: "1.0"

skills:
  # Test-Driven Development workflow
  - name: tdd
    skill_path: tdd/SKILL.md
    description: >
      Enforces RED → GREEN → REFACTOR workflow. Blocks implementation
      until tests are written and passing.
    provides:
      - test_written      # Phase 1: RED - failing test exists
      - test_green        # Phase 2: GREEN - test passes
      - test_refactored   # Phase 3: REFACTOR - code cleaned up
    requires: []
    conflicts:
      - quick-fix         # TDD is incompatible with quick fixes
    risk: low
    cost: medium
    artifacts:
      - name: test_file
        type: file_exists
        pattern: "**/*.test.ts"
      - name: test_passing
        type: command_success
        command: npm test
    tool_policy:
      # Path-aware blocking: block implementation writes until test exists,
      # but always allow writing test files (write_test is never blocked).
      deny_until:
        write_impl:
          until: test_written
          reason: "TDD RED: Write a failing test first, then implement"
        commit:
          until: test_green
          reason: "TDD GREEN: Tests must pass before committing"

  # Prevents manual workarounds when building tools
  - name: no-workarounds
    skill_path: no-workarounds/SKILL.md
    description: >
      Blocks manual workarounds when developing CLI tools or automation.
      Forces fixing the tool instead of working around failures.
    provides:
      - tool_verified     # The tool being built actually works
    requires: []
    conflicts: []
    risk: low
    cost: low
    artifacts:
      - name: tool_works
        type: command_success
        command: npm run build
    tool_policy:
      deny_until:
        write:
          until: tool_verified
          reason: "Fix the tool, don't work around it manually"

  # Documentation maintenance after task completion
  - name: doc-maintenance
    skill_path: doc-maintenance/SKILL.md
    description: >
      Updates PLAN.md with completed tasks and README.md when features change.
      Triggers after any task completion.
    provides:
      - docs_updated      # Documentation is current
      - plan_synced       # PLAN.md reflects actual state
    requires:
      - test_green        # Only update docs after tests pass
    conflicts: []
    risk: low
    cost: low
    artifacts:
      - name: plan_updated
        type: marker_found
        file: PLAN.md
        pattern: "\\[x\\]"
    tool_policy: {}

  # Enforces dogfooding the skills CLI
  - name: dogfood-skills
    skill_path: dogfood-skills/SKILL.md
    description: >
      Enforces running 'skills scan' after completing features.
      Ensures the skills CLI is used to validate itself.
    provides:
      - dogfood_verified  # Skills CLI was used on itself
    requires:
      - test_green        # Only dogfood after tests pass
    conflicts: []
    risk: low
    cost: low
    artifacts:
      - name: scan_run
        type: command_success
        command: ./packages/cli/bin/skills.js scan
    tool_policy: {}

  # Cleans up test artifacts and slop
  - name: repo-hygiene
    skill_path: repo-hygiene/SKILL.md
    description: >
      Terminal skill that cleans test-skill-* directories and stale references.
      Should run at end of testing workflows.
    provides:
      - repo_clean        # Repository is free of slop
    requires:
      - docs_updated      # Cleanup after docs are updated
    conflicts: []
    risk: low
    cost: low
    artifacts:
      - name: no_test_skills
        type: command_success
        command: "! ls .claude/skills/test-skill-* 2>/dev/null"
    tool_policy: {}

  # Suggest tests based on git diff
  - name: suggest-tests
    skill_path: suggest-tests/SKILL.md
    description: >
      Analyzes git diff to recommend test additions. Identifies HIGH/MEDIUM/LOW
      risk changes that need coverage.
    provides:
      - test_recommendations  # Analysis of what tests are needed
    requires:
      - test_refactored       # Run after TDD REFACTOR phase
    conflicts: []
    risk: low
    cost: medium
    artifacts: []
    tool_policy: {}

  # Comprehensive unit test generation
  - name: unit-test-workflow
    skill_path: unit-test-workflow/SKILL.md
    description: >
      Multi-phase workflow for generating comprehensive unit tests.
      Detects language, framework, and generates appropriate tests.
    provides:
      - tests_generated     # Comprehensive tests exist
    requires:
      - test_recommendations  # Know what tests to write first
    conflicts: []
    risk: low
    cost: high
    artifacts:
      - name: test_coverage
        type: file_exists
        pattern: "coverage/**/*"
    tool_policy: {}

  # Property-based testing guidance
  - name: property-based-testing
    skill_path: property-based-testing/SKILL.md
    description: >
      Adds property-based tests for serialization, validation, and pure functions.
      Detects roundtrip, idempotence, and invariant opportunities.
    provides:
      - pbt_coverage        # Property tests exist
    requires:
      - tests_generated     # Build on existing unit tests
    conflicts: []
    risk: low
    cost: high
    artifacts:
      - name: property_tests
        type: file_exists
        pattern: "**/*.property.test.ts"
    tool_policy: {}
